<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>AR Viewer</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="showMarkerInfo()">
        <ion-icon slot="icon-only" name="help-circle"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Contenedor AR -->
  <div id="ar-container">
    <a-scene
      #arScene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono; matrixCodeType: 3x3_HAMMING_63;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; precision: medium;">
      
      <!-- CÃ¡mara AR -->
      <a-entity camera></a-entity>
      
      <!-- Marcador Hiro (preestablecido - FUNCIONA!) -->
      <a-marker 
        #arMarker
        preset="hiro"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        emitevents="true"
        id="hiro-marker">
        
        <!-- Contenedor para modelos 3D -->
        <a-entity 
          #arContent
          id="ar-content"
          position="0 0.5 0"
          scale="1 1 1">
        </a-entity>
      </a-marker>
      
      <!-- Marcador Kanji (alternativo) -->
      <a-marker 
        preset="kanji"
        smooth="true"
        smoothCount="10"
        emitevents="true"
        id="kanji-marker">
        
        <a-entity 
          id="ar-content-kanji"
          position="0 0.5 0"
          scale="1 1 1">
        </a-entity>
      </a-marker>
    </a-scene>
  </div>

  <!-- Panel de escaneo -->
  <div class="ar-controls" *ngIf="!isMarkerVisible">
    <div class="scanning-indicator">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Buscando marcador Hiro o Kanji...</p>
      <small>Descarga e imprime el marcador</small>
      
      <div class="marker-options">
        <button class="marker-btn hiro-btn" (click)="downloadMarker('hiro')">
          ðŸ“¥ Descargar Hiro
        </button>
        <button class="marker-btn kanji-btn" (click)="downloadMarker('kanji')">
          ðŸ“¥ Descargar Kanji
        </button>
      </div>
    </div>
  </div>

  <!-- ConfirmaciÃ³n de detecciÃ³n -->
  <div class="ar-info" *ngIf="isMarkerVisible">
    <ion-chip color="success">
      <ion-icon name="checkmark-circle"></ion-icon>
      <ion-label>âœ“ Marcador detectado</ion-label>
    </ion-chip>
  </div>

  <!-- Botones de acciÃ³n -->
  <div class="action-buttons">
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button color="primary">
        <ion-icon name="apps"></ion-icon>
      </ion-fab-button>
      <ion-fab-list side="top">
        <ion-fab-button color="light" (click)="changeModel('box')" title="Cubo">
          <ion-icon name="cube"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="changeModel('sphere')" title="Esfera">
          <ion-icon name="radio-button-on"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="changeModel('cylinder')" title="Cilindro">
          <ion-icon name="battery-charging"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="changeModel('pyramid')" title="PirÃ¡mide">
          <ion-icon name="triangle"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="rotateContent()" title="Rotar">
          <ion-icon name="sync"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="takeScreenshot()" title="Captura">
          <ion-icon name="camera"></ion-icon>
        </ion-fab-button>
      </ion-fab-list>
    </ion-fab>
  </div>
</ion-content>