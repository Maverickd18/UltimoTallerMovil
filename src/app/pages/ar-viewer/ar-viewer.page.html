<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>AR Viewer</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="showMarkerInfo()">
        <ion-icon slot="icon-only" name="help-circle"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Contenedor AR -->
  <div id="ar-container">
    <a-scene
      #arScene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true;"
      device-orientation-permission-ui="enabled: false">
      
      <!-- C√°mara AR -->
      <a-entity camera look-controls-enabled="false" arjs-look-controls="smoothingFactor: 0.1"></a-entity>
      
      <!-- Marcador Hiro -->
      <a-marker 
        #arMarker
        preset="hiro"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
        emitevents="true"
        id="hiro-marker"
        raycaster="objects: .clickable">
        
        <a-entity 
          #arContent
          id="ar-content"
          position="0 0 0"
          scale="1 1 1">
        </a-entity>
      </a-marker>
      
    </a-scene>
  </div>

  <!-- Panel de escaneo -->
  <div class="ar-controls" *ngIf="!isMarkerVisible">
    <div class="scanning-indicator">
      <ion-spinner name="crescent"></ion-spinner>
      <p>üîç Buscando marcador...</p>
      <small>Descarga e imprime un marcador</small>
      
      <div class="marker-options">
        <button class="marker-btn hiro-btn" (click)="downloadMarker('hiro')">
          üì• Descargar Hiro
        </button>
        <button class="marker-btn kanji-btn" (click)="downloadMarker('kanji')">
          üì• Descargar Kanji
        </button>
      </div>

      <div class="tips-section">
        <p style="font-size: 12px; color: rgba(255,255,255,0.8); margin-top: 15px;">
          üí° <strong>Consejo:</strong> Mant√©n buena iluminaci√≥n y el marcador plano
        </p>
      </div>
    </div>
  </div>

  <!-- Confirmaci√≥n de detecci√≥n -->
  <div class="ar-info" *ngIf="isMarkerVisible">
    <ion-chip color="success">
      <ion-icon name="checkmark-circle"></ion-icon>
      <ion-label>‚úì Marcador detectado</ion-label>
    </ion-chip>
  </div>

  <!-- Botones de acci√≥n -->
  <div class="action-buttons">
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button color="primary">
        <ion-icon name="apps"></ion-icon>
      </ion-fab-button>
      <ion-fab-list side="top">
        <ion-fab-button color="light" (click)="changeModel('box')" title="Cubo">
          <ion-icon name="cube"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="changeModel('sphere')" title="Esfera">
          <ion-icon name="radio-button-on"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="changeModel('cylinder')" title="Cilindro">
          <ion-icon name="battery-charging"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="changeModel('pyramid')" title="Pir√°mide">
          <ion-icon name="triangle"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="rotateContent()" title="Rotar">
          <ion-icon name="sync"></ion-icon>
        </ion-fab-button>
        <ion-fab-button color="light" (click)="takeScreenshot()" title="Captura">
          <ion-icon name="camera"></ion-icon>
        </ion-fab-button>
      </ion-fab-list>
    </ion-fab>
  </div>
</ion-content>