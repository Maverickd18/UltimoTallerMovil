<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Mis Assets AR</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshAssets()">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="assets-container">
    
    <!-- Upload Section -->
    <div class="upload-section">
      <h2>Subir Nuevo Asset</h2>
      <p class="subtitle">Sube im치genes para usar en AR - Se generar치 un marcador autom치ticamente</p>
      
      <div class="upload-zone" (click)="fileInput.click()">
        <input 
          #fileInput 
          type="file" 
          accept="image/*" 
          (change)="onFileSelected($event)"
          style="display: none">
        
        <ion-icon name="cloud-upload" class="upload-icon"></ion-icon>
        <p class="upload-text">Click para seleccionar imagen</p>
        <small>PNG, JPG, JPEG (Max 5MB)</small>
        <small style="display: block; margin-top: 8px; color: #4285F4; font-weight: 600;">
          游꿢 Se crear치 un marcador personalizado
        </small>
      </div>

      <!-- Preview del archivo seleccionado -->
      <div *ngIf="selectedFile && !uploading" class="preview-section">
        <ion-card>
          <ion-card-header>
            <ion-card-subtitle>Vista previa</ion-card-subtitle>
            <ion-card-title>{{ selectedFile.name }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <img *ngIf="previewUrl" [src]="previewUrl" alt="Preview" class="preview-image">
            <p class="preview-info">
              <ion-icon name="document"></ion-icon>
              Tama침o: {{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB
            </p>
          </ion-card-content>
        </ion-card>
      </div>

      <ion-button 
        *ngIf="selectedFile"
        expand="block" 
        color="primary"
        (click)="uploadFile()"
        [disabled]="uploading">
        <ion-icon slot="start" name="cloud-upload"></ion-icon>
        {{ uploading ? 'Subiendo y generando marcador...' : 'Subir ' + selectedFile.name }}
        <ion-spinner *ngIf="uploading" name="crescent" slot="end"></ion-spinner>
      </ion-button>
    </div>

    <!-- Assets List -->
    <div class="assets-list">
      <h2>Tus Assets</h2>
      
      <div *ngIf="loading" class="loading-state">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando assets...</p>
      </div>

      <div *ngIf="!loading && assets.length === 0" class="empty-state">
        <ion-icon name="images-outline"></ion-icon>
        <p>No tienes assets a칰n</p>
        <small>Sube tu primera imagen para empezar</small>
      </div>

      <ion-list *ngIf="!loading && assets.length > 0">
        <ion-item *ngFor="let asset of assets" class="asset-item">
          <ion-thumbnail slot="start">
            <img [src]="asset.file_url" [alt]="asset.name">
          </ion-thumbnail>
          
          <ion-label>
            <h3>{{ asset.name }}</h3>
            <p>{{ asset.created_at | date:'short' }}</p>
            <ion-chip *ngIf="asset.marker_url" color="success" class="marker-chip">
              <ion-icon name="qr-code"></ion-icon>
              <ion-label>Marcador generado</ion-label>
            </ion-chip>
            <ion-chip *ngIf="!asset.marker_url" color="warning" class="marker-chip">
              <ion-icon name="alert-circle"></ion-icon>
              <ion-label>Sin marcador</ion-label>
            </ion-chip>
          </ion-label>
          
          <!-- Ver marcador -->
          <ion-button 
            *ngIf="asset.marker_url"
            slot="end" 
            fill="clear" 
            color="secondary"
            (click)="viewMarker(asset)">
            <ion-icon slot="icon-only" name="qr-code"></ion-icon>
          </ion-button>

          <!-- Ver en AR -->
          <ion-button 
            slot="end" 
            fill="clear" 
            color="primary"
            (click)="viewInAR(asset)">
            <ion-icon slot="icon-only" name="scan"></ion-icon>
          </ion-button>
          
          <!-- Eliminar -->
          <ion-button 
            slot="end" 
            fill="clear" 
            color="danger"
            (click)="deleteAsset(asset)">
            <ion-icon slot="icon-only" name="trash"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
    </div>

  </div>
</ion-content>